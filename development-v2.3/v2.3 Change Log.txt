iCloud3 v2.3 Change Log
-----------------------------

v2.3c (1/6/2021)
---------------
1. Reset the priority order for checking for the config_ic3,yaml file to:
    - DirectorySpecified/FileNameSpecified
    - /config/FileNameSpecified
    - /config/custom_components/icloud3/FileNameSpecified
    - /config/config_ic3.yaml
    - /config/custom_components/icloud3/config_ic3.yaml

v2.3b (1/5/2021)
---------------
1. Fixed a bug where the last device_name in the devices list was not added to the list of tracked devices if it was the last one and there were no parameters after the devices parameter. This didn't happen if there was another parameter after the 'devices:' parameter.
2. Fixed a bug caused by a misspelled variable name (device_field vs device_fields).
3. Added error checking to prevent a crash during startup if there were any delays in retrieving location data from iCloud before everything had been set up.
4. Fixed a bug were quote marks ("...") were not being stripped from values in the config_ic3.yaml file.


v2.3 (1/3/2021)
---------------
1. Added configuration parameters that use the standard HA method of defining device_tracker/entity items. The following example will make this clear. They are all acceptible and will all result in tracking the 2 device.

    This is how tracked_device parameters are specified now:
        track_devices:
          - gary_iphone > gary_2fa@email.com, gary.png, Gary
          - lillian_iphone > lillian_2fa@email.com, lillian.png, Lillian
          
    You can also use this format:
        devices:
          - device: gary_iphone > gary_2fa@email.com, gary.png, Gary
          - device_name: lillian_iphone
            email: lillian_2fa@email.com
            picture: lillian.png
            name: Lillian
    
    Or you can use this format:
        devices:
          device: gary_iphone > gary_2fa@email.com, gary.png, Gary
          device: lillian_iphone > lillian_2fa@email.com, lillian.png, Lillian

            
    The parameters that can be used to define a device are:
    - device_name:      
            Specifies the name of the device that you want to track. It must be the same as the one in the Setting App > General > About > Name field on the device.
    - name:             
            The persons name associated with the device. Each device should have it's own name even if it is associated with the same person.
    - email:            
            The persons email address that is used to search the FindMy Person list. This is not needed if you want to use the Family Sharing list.
    - picture:          
            The picture of the person show on the persons 'badge'.
    - iosapp_suffix:    
            The suffix of the iOS App device_tracker entity to monitor for zone enter/exits and location changes (entity name = device_name + suffix). iCloud3 searches the HA Entity Registry and looks for iOS App device_tracker entities that start with the device_name. The last one in the list is selected. This parameter lets you override the iCloud3 selection.
    - iospp_entity:     
            The name of the iOS App device_tracker entity to monitor for zone enter/exits and location changes.
    - noiosapp: True    
            Used to indicate the iOS App is not installed on this device and it should not be monitored for zone enter/exits and location changes.
    - zone:             
            The name of additional zone(s) to be used for location tracking. The Home zone is always monitored and does not need to be specified.
          
2. An alert message is now displayed if there are no mobile_app entities found in the Entity Registry. If this happens, no devices will be monitored for zone enter/exits and location changes using the iosapp.
3. The 'config_ic3_file_name' parameter now only needs to be specified if it is not /config/config_ic3.yaml. iCloud3 will now always look in the /config directory for the config_ic3.yaml file and will use it if it is found. If it is not found, the custom_components/icloud3 directory will be chedked.
4. Code cleanup and additional error checking.
5. Bumped the version number to v2.3 since this is a significant update from v2.2.2rc#.
6. Final release preparations.


iCloud3 v2.2.2rc9a Change Log
------------------------------
1. Removed debug logging code from pyicloud3_ic3.
2. Fixed a problem calculating the default old_location_threshold value.


iCloud3 v2.2.2rc9 Change Log
------------------------------
1. The FmF and FamShr tracking method for each device are now analyzed to minimize calls to iCloud Web Services. The goal is to have all devices using either FmF or FamShr but not both. If you are tracking a friend (their email address is specified) that is not on your Family Sharing list, the friend will be located using the FmF method like it always has and the other devices will use FamShr.
2. Added check for an email addresses used for more than one devicename.

iCloud3 v2.2.2rc8b Change Log
------------------------------
1. Fixed bug where an error message would be added to the Event Log when scanning the FmF People list during initialization if the tracked_device did not have an email address.
2. Added debug trace code to the _update_location routine

iCloud3 v2.2.2rc8 Change Log
------------------------------
1. The Find-my-Friends (fmf) and the Family Sharing (famshr) have been combined into a single tracking method (icloud) and operates on a per device basis. When iCloud3 starts, the FindMy People list is analyzed for devices to be tracked, followed by the FindMy Me selection (this device is My Location), followed by the Family sharing list. You no longer need to assign a tracking method to use iCloud Location Services. Each device you are tracking will automatically select the appropriate tracking method based on how it is set up in your iCloud account.
2. Changed the list in Stage 2 of iCloud3 initialization to show all the people and devices in the FindMy app and all the devices in the Family Sharing list. A check mark is next to the track_device in your configuration parameters indicating the tracking method selected for that device.
3. Changed the default for the 'ignore_inzone_gps_accuracy' from True to False to prevent wild gps accuracy issues taking you out of a zone.
4. Code cleanup.
5. TODO - Further analysis of pyicloud_ic3 data requests for the fmf and famshr support. There is some tuning to be done, reviewing the data returned to make sure unnecessary requests are not being made and investigate the possibility of only requesting location data for the devices that need it rather than every device.



iCloud3 v2.2.2rc7 Change Log
------------------------------
1. Incorporates a new method of automatically authenticating the account within the pyicloud_ic3.py iCloud Web Interface program rather than having iCloud3 do it.

Other changes
-------------
2. The email from Apple about someone signing on to the iCloud account should only occur when starting HA or when selecting Event Log > Actions > Reset iCloud Interface.
3. Fixed a misspelling of self.format_age that was generating an error. It should be self._format_age.
4. Fixed a problem occuring when the name of the phone was 'iPhone'.
5. Fixed a problem where state changes were detected when it did not change. This related to long zone names with spaces and underline characters.

iCloud3 v2.2.2rc6 Change Log
------------------------------
1. Incorporates the latest iCloud account authorization routines to minimize the emails received from Apple and reduce the amount of communication between iCloud3 and the iCloud account to authorize an account. (change to pyicloud_ic3.py)

Other Changes
-------------
2. The email from Apple about someone signing on to the iCloud account should only occur when starting HA or when selecting Event Log > Actions > Reset iCloud Interface.
3. Fixed a misspelling of self.format_age that was generating an error. It should be self._format_age.
4. Fixed a problem occuring when the name of the phone was 'iPhone'.
5. Fixed a problem where state changes were detected when it did not change. This related to long zone names with spaces and underline characters.